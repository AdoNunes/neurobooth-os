<!DOCTYPE html>

<html lang="en">

<!--[if lt IE 10]>

    <script type="text/javascript">

        alert("The content of this web page may not work as intended in " +
              "the current browser. " +
              "Internet Explorer 10 or newer is required for full functionality.");
    </script>

<![endif]-->

<head>

<!-- Metadata ************************************************************** -->

    <meta charset="UTF-8">
    <meta name="description" content="Digit Symbol Coding test">
    <meta name="copyright" content="2017 The Many Brains Project, Inc.">
    <meta name="author" content="Paolo Martini">
    <meta name="keywords" content="cognitive test, brain test, digit-symbol coding">

    <!-- Configs for mobiles -->

    <!-- Set the viewport. -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Allow web app to be run in full-screen mode. -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Make the app title different than the page title. -->
    <meta name="apple-mobile-web-app-title" content="TMB DSC">

    <!-- Icons. -->

    <link rel="apple-touch-icon" sizes="180x180" href="../../images/icons/apple-touch-icon.png">
    <link rel="shortcut icon" href="../../images/icons/favicon.ico">

<!-- End of metadata ******************************************************* -->

<!-- Â© 2016 The Many Brains Project, Inc.

    July 2019 Ver. 3.1

     For Usage, enter:

      DSC.html?help

     For reference see:

      Thorndike, E. A standardized group examination of intelligence
        independent of language. J. of Applied Psych, 1919, 3(1), 13-32.

      Wechsler, D. (1981). Manual for the Wechsler Adult Intelligence
        Scale - Revised. New York: Psychological Corporation.

      McLeod et Al. An automated version of the digit symbol substitution
        test. Behav. Res. Meth. & Instr. 1982, 14(5), 463-466

      Salthouse, T.A., What do adult age differences in the digit symbol
        substitution test reflect? J. of Gerontology, 1992, 47(3), 121-128

     Notes:

      On each trial, symbol choice is pseudo-random with lag 1 repetition
      avoidance. RT outcomes are calculated on correct responses. Available
      input is keyboard and touch.

-->

<!-- Title ***************************************************************** -->

    <title>Digit Symbol Coding Test</title>

<!-- End of Title ********************************************************** -->

<!-- css Style declarations ************************************************ -->

    <style type="text/css">

        *
        {
            border-radius: 0;
            box-sizing: border-box;
        }

        *::after, *::before
        {
            box-sizing: border-box;
        }

        body
        {
            width: 100vw;
            height: 100vh;
            margin: auto;
            background: #ffffff;
            color: #000000;
            font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
            font-size: 13pt;
            text-align: center;
        }

        #container
        {
            height: 470px;
            width: 310px;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -235px;
            margin-left: -155px;
            display: none;
        }

        .button
        {
            border: 2px solid #f1c40f;
            border-radius: 1em;
            background: transparent;
            color: #000000;
            box-shadow: 0 5px 15px 5px grey
        }

        .button:active
        {
            box-shadow: 0 5px 15px 1px lightgrey
        }

        .button:focus
        {
            outline: none
        }

        .img-responsive
        {
            display: inline-block;
            max-width: 100%;
            height: auto;
            border: 5px solid white;
        }

    </style>

<!-- end of css Style declarations ***************************************** -->

<!-- required js libraries ************************************************* -->

    <script type="text/javascript" src="TestMyBrain.12.18.min.js"></script>
    <script src="eel.js"></script>

<!-- end of required js libraries ****************************************** -->

<!-- js script ************************************************************* -->

    <script type="text/javascript">

    var testVersion;                // version identifier for this test
    var chosenInput;                // input type (taps or keys)
    var symbol;                     // the symbol to show (1-9)
    var digit;                      // the digit corresponding to the symbol
    var correct;                    // correct=1, wrong=0
    var testStart = 0;              // start timestamp of the test
    var score = 0;                  // accumulated score
    var results = [];               // array to store trials details and responses
    var outcomes = {};              // object containing outcome variables
    var frameSequence = [];         // object containing the sequence of frames and their properties
    var frame;                      // single frame object
    var seed;                       // URL parameter: random number generator seed
    var debug;                      // URL parameter: output to console
    var demo;                       // URL parameter: run in demo mode
    var showresults;                // URL parameter: if they want to show results in a popup window
    var autosave;                   // URL parameter: if they want to save data in a file automatically
    var filename;                   // filename for data
    var usage = "";                 // URL parameter: show usage

    // specify actions to take on user input
    tmbUI.onreadyUI = function()
    {
        // if we are debugging and there was an error, log the message
        if(debug === 'true' && tmbUI.message) console.log(tmbUI.message);

        // is the response correct?
        correct = parseInt(tmbUI.response.slice(-1)) === frame.digit ? 1 : 0;

        // store the results
        if(frame.type === "practice" ||
           (frame.type === "test" && tmbUI.status !== "timeout"))
        {
            results.push(
                    {
                        type: frame.type, // one of practice or test
                        symbol: frame.symbol, // symbol index
                        digit: frame.digit, // symbol digit
                        response: tmbUI.response.slice(-1), // the key or element chosen
                        correct: correct, // boolean correct
                        rt: tmbUI.rt, // response time
                        timestamp: tmbUI.downTimestamp, // response timestamp
                        state: tmbUI.status // state of the response handler
                    });

            // if we are debugging, log the results
            if(debug === 'true')
            {
                logResults(results,'inc');
            }
        }

        if(frame.type === "practice")
        {
            // on practice trials, if the input event returns a timeout
            // or the response is not correct,
            // stop the sequence and advise the participant
            if(tmbUI.status === "timeout" || !correct)
            {
                // rewind the frame sequence by one frame,
                // so that the same frame is displayed again
                frameSequence.unshift(frame);

                showAlert("<br><img src=" + frame.source + " alt='Symbol'><br>" +
                          (chosenInput === 'taps' ? ("<br>You should tap <b>" + frame.digit + "</b><br>")
                                                  : ("<br>You should press " + frame.digit +
                                                     " on the <b>keyboard</b> <br>")) +
                          "when you see this symbol.<br><br>",
                          "Click here to retry",
                          function()
                          {
                              showFrame("null");
                              nextTrial();
                          },
                          '20pt');
            }
            else
            {
                nextTrial();
            }
        }
        else if(frame.type === "test")
        {
            if(tmbUI.status !== "timeout")
            {
                // choose a symbol randomly, but avoid 1-back repetitions
                while ((symbol = randInt(1, 6)) === frame.symbol) {}
                digit = symbol % 3 === 0 ? 3 : symbol % 3;

                // set up the next frame
                frameSequence.push(
                        {
                            type: "test",
                            message: "",
                            symbol: symbol,
                            digit: digit,
                            source: "images/" + symbol + ".gif"
                        });
            }

            nextTrial();
        }
    };

    function nextTrial()
    {
        // read the frame sequence one frame at a time
        frame = frameSequence.shift();
        if(frame)
        {
            // check if it's the startup frame
            if (frame.type === "begin") showAlert(frame.message,
                                                 "Click here for instructions",
                                                 function ()
                                                 {
                                                     showFrame("null");
                                                     nextTrial();
                                                 },
                                                 '20pt');

            // else if it's a message frame, show it
            else if (frame.type === "message") showAlert(frame.message,
                                                        "Click here to continue",
                                                        function ()
                                                        {
                                                            showFrame("null");
                                                            nextTrial();
                                                        },
                                                        '20pt');
            // deal with practice and test frames
            else
            {
                // hide the cursor
                hideCursor("document.body");

                // set the image source of the symbol
                getID("probe").src = frame.source;

                // set response timeout:
                // - for practice trials -> a fixed interval
                // - for test trials -> what's left of 90 seconds since start,
                //                      with a minimum of 150 ms
                if(frame.type === "practice") tmbUI.timeout = 5000;
                else
                {
                    if(!testStart) testStart = now();
                    if(demo === 'true') tmbUI.timeout = 10000 - (now() - testStart);
                    else tmbUI.timeout = 90000 - (now() - testStart);
                    if(tmbUI.timeout < 150) tmbUI.timeout = 150;
                }

                requestAnimationFrame(function()
                {
                    showFrame("container","probeRow","keyRow1","keyRow2","response");
                    tmbUI.getInput();
                });
            }
        }
        // else if the sequence is empty, we are done!
        else
        {
            showCursor("document.body");

            // all test trials (excluding practice and timeouts)
            var tmp1 = results.filter(function( obj )
            {
                return obj.type !== 'practice' &&
                       obj.state !== 'timeout';
            });

            // all correct rts
            var tmp2 = tmp1.filter(function( obj )
            {
                return obj.correct === 1;
            }).pluck('rt');

            // response device
            var tmp3 = tmp1[0].state;
            tmp3 = /key/i.test(tmp3) ? 'keyboard' :
                   /touch/i.test(tmp3) ? 'touch' :
                   /mouse/i.test(tmp3) ? 'mouse' :
                   /pen/i.test(tmp3) ? 'pen' :
                   'unknown';

            // compute score and outcome variables
            score = outcomes.score = tmp2.length;
            outcomes.num_correct = tmp2.length;
            outcomes.num_responses = tmp1.length;
            outcomes.meanRTc = tmp2.length ? tmp2.average().round(2) : 0;
            outcomes.medianRTc = tmp2.length ? tmp2.median().round(2) : 0;
            outcomes.sdRTc = tmp2.length ? tmp2.sd().round(2) : 0;
            outcomes.responseDevice = tmp3;
            outcomes.testVersion = testVersion;

            eel.get_data(results,score,outcomes)




        }
    }

    function setFrameSequence()
    {
        var testMessage;

        // messages
        testMessage =
        {
            "begin": ("<h2>Digit-Symbol Coding Test</h2><br>" +
                      "<img src='images/key.png' alt='Title image'><br><br>"),
            "practice": [("<h3>Instructions:</h3>" +
                          "<br><img src='images/key.png' alt='Instructions'><br><br>" +
                          "Each <b>symbol</b> has a <b>number</b>.<br><br>"),
                         ("<img src='images/1.gif' alt='Instructions'><br>" +
                          "<img src='images/keySmall.png' alt='Instructions'><br><br>" +
                          "When a symbol appears at the top,<br>" +
                          (chosenInput === 'taps' ? "tap its number<br>"
                                                  : "press its number on the <b>keyboard</b><br>") +
                          "(here it is 1).<br><br>"),
                         ("<img src='images/2.gif' alt='Instructions'><br>" +
                          "<img src='images/keySmall.png' alt='Instructions'><br><br>" +
                          "Let's practice a few symbols.<br><br><br>")],
            "test": ("Excellent!<br>" +
                     "You have completed the practice.<br>" +
                     "Now let's do more.<br><br>" +
                     "Your score will be<br>" +
                     "how many correct responses<br>" +
                     "you make in a minute and a half,<br>" +
                     "so try to be <b>ACCURATE</b> and <b>QUICK</b>!<br><br>")
        };

        // type of frame to display
        var frameType = ["begin","message","message",
                         "practice","practice","practice",
                         "message","test"];

        // message to display
        var frameMessage = [testMessage.begin,
                            testMessage.practice[0],testMessage.practice[1],
                            "","","",
                            testMessage.test,""];

        // symbol to display
        var frameSymbol = [0,0,0,1,3,5,0,4];

        // corresponding digit
        var frameDigit = [0,0,0,1,3,2,0,1];

        // push all components into the frames chain
        for(var i=0; i<frameType.length; i++)
        {
            frameSequence.push(
                    {
                        type: frameType[i],
                        message: frameMessage[i],
                        symbol: frameSymbol[i],
                        digit: frameDigit[i],
                        source: "images/" + frameSymbol[i] + ".gif"
                    });
        }
    }

    function setup(input)
    {
        // determine events to listen to and
        // customize response elements
        chosenInput = input;
        if(chosenInput === 'taps')
        {
            tmbUI.UIevents = 'taps';
        }
        else
        {
            tmbUI.UIevents = ['keys'];
            tmbUI.UIkeys = [keyToCode('1'),keyToCode('2'),keyToCode('3')];
        }
        tmbUI.UIelements = ['resp1','resp2','resp3'];
        tmbUI.highlight = "red";

        // add appropriate meta viewport for scaling
        setMobileViewportScale(520,620);

        // create the trials chain
        setFrameSequence();

        // preload images and start the testing sequence
        var images = [];

        for(var i = 0; i < 6; i++) images[i] = "images/" + (i+1) + ".gif";
        images[6] = "images/resp1.png";
        images[7] = "images/resp2.png";
        images[8] = "images/resp3.png";
        images[9] = "images/key.png";
        images[10] = "images/keySmall.png";

        imagePreLoad(images,{callBack: nextTrial});
    }

    window.onload = function()
    {
        // see if they are just asking for help
        if ((usage = getUrlParameters("help", "", true)))
        {
            showAlert("<b>Usage:</b>" +
                      "<br>DSC.html?urlparam1=true&urlparam2=false<br><br>" +
                      "<b>URL Parameters</b>:<br>" +
                      "<i>seed=12345</i> -- choose a random generator's seed<br>" +
                      "<i>demo=true</i> -- runs in demo mode only for 10 seconds<br>" +
                      "<i>debug=true</i> -- outputs trial by trial info to the console<br>" +
                      "<i>showresults=true</i> -- allows to save results locally in a file<br>" +
                      "<i>autosave=true</i> -- will attempt to save results automatically to file<br>" +
                      "<i>filename=subject1.csv</i> -- the filename to save results to<br>" +
                      "<i>help</i> -- print this message");
            return;
        }

        // check if this is a debug session
        debug = getUrlParameters("debug", "", true);

        // check if they want a demo run
        demo = getUrlParameters("demo", "", true);

        // check if they want to load results in a new page when the test is over,
        // if data is to be saved automatically to a file and the filename
        showresults = getUrlParameters("showresults", "", true);
        autosave = getUrlParameters("autosave", "", true);
        filename = getUrlParameters("filename", "", true);

        // set the random seed
        seed = getUrlParameters("seed", "", true);
        if(!seed) seed = "DScoding";
        Math.seedrandom(seed);

        // set the test version
        testVersion = 'DSC_simplified_oneProbe_2019';

        // disable spurious user interaction
        disableSelect();
        disableRightClick();
        disableDrag();
        disableDoubleTapZoom();

        if(!hasTouch) setup('keys');
        else chooseInput({keyboard: true, touch: true},setup);
    }

    </script>

<!-- end of js script ****************************************************** -->

</head>

<!-- HTML content ********************************************************** -->

<body>

<div id="container">
    <div id="probeRow">
        <img id="probe" class="img-responsive" src="images/1.gif">
    </div>
    <br><br>
    <div id="keyRow1">
        <img src="images/1.gif">
        <img src="images/2.gif">
        <img src="images/3.gif">
    </div>
    <div id="keyRow2">
        <img src="images/4.gif">
        <img src="images/5.gif">
        <img src="images/6.gif">
    </div>
    <div id="response">
        <img class="img-responsive" id="resp1" src="images/resp1.png">
        <img class="img-responsive" id="resp2" src="images/resp2.png">
        <img class="img-responsive" id="resp3" src="images/resp3.png">
    </div>
</div>


    <noscript>
    For full functionality of this site it is necessary to enable JavaScript.<br>
    Here are the <a href="http://www.enable-javascript.com/" target="_blank">
    instructions</a> how to enable JavaScript in your web browser.
    </noscript>
</body>

</html>